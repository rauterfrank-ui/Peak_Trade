# FND-0002: Dual Risk Systems - Potential for Confusion

## Metadata
- **Severity:** P2 Medium
- **Subsystem:** Risk / Architecture
- **Discovered:** 2025-12-30
- **Status:** **FIXED** ✅
- **Fixed Date:** 2025-12-30
- **Phase:** Architecture Inventory (A1) → Remediation (Agent D)

## Description

The codebase contains **two separate risk-related modules** with similar names:
1. `src/risk/` - 20 files - Legacy/core risk module
2. `src/risk_layer/` - 5+ subdirectories - New risk layer (kill_switch, alerting, var_backtest)

**Observed Structure:**
```
src/risk/           (20 files)
src/risk_layer/
  ├── kill_switch/   (new, well-documented)
  ├── alerting/      (new alert system)
  ├── var_backtest/  (VaR backtesting)
  └── models.py      (Violation model)
```

**Potential Issues:**
- Unclear which module is "authoritative" for different risk concerns
- Naming similarity (`risk` vs `risk_layer`) may cause confusion
- Risk of duplicate implementations or conflicting logic
- Documentation gap: relationship between modules not clear from names

## Impact

**Why this matters:**
- Developers may not know which module to use for new risk features
- Maintenance burden: two separate codebases for risk
- Risk of inconsistent risk policies if modules diverge
- Audit complexity: must review both modules

**Failure Mode:**
- Risk check implemented in wrong module and not enforced in live path
- Config mismatch between old and new systems
- Migration from `risk&#47;` to `risk_layer&#47;` incomplete

## Evidence

- **Evidence ID:** EV-1002, EV-1004
- **Location:**
  - `src/risk/` - directory with 20 files
  - `src/risk_layer/` - directory with subdirectories
  - Directory listing: `docs/audit/evidence/snapshots/repo_subsystems_20251230.txt`

## Reproduction Steps

```bash
cd /Users/frnkhrz/Peak_Trade
ls -la src/risk/
ls -la src/risk_layer/
```

## Remediation Plan

### Proposed Fix

**Immediate (P2 - Can be addressed post-launch in bounded mode):**

1. **Documentation:**
   - Create `docs/architecture/RISK_MODULES.md` explaining:
     - Purpose of each module
     - Which module handles what responsibilities
     - Migration plan (if `risk_layer&#47;` is intended to replace `risk&#47;`)
     - When to use each module

2. **Code Comments:**
   - Add README.md to both `src/risk/` and `src/risk_layer/`
   - Cross-reference between modules
   - Deprecation notice if `src/risk/` is legacy

3. **Audit Investigation:**
   - Review `src/risk/` to determine if it's still actively used in live path
   - Identify any overlapping functionality
   - Document dependencies (what imports from where)

**Future (Post-Live):**
- Consider renaming or consolidating if feasible
- Migrate remaining `src/risk/` functionality to `src/risk_layer/` if that's the direction
- Remove deprecated code

### Owner
[TBD - Architecture/Risk Team]

### Due Date
[TBD - P2, can be addressed after initial launch]

### Verification
- [x] ✅ README.md created for `src/risk/` (backtest/research risk)
- [x] ✅ README.md created for `src/risk_layer/` (live trading risk)
- [x] ✅ Clear distinction documented (analytical vs operational)
- [x] ✅ Usage guidelines provided

### Resolution: READMEs document that both modules serve different purposes by design. Evidence: EV-9004

## Related Items

- **Related Findings:**
  - FND-0001 (Live mode safety gates)

- **Related Risks:**
  - RISK-004 (Risk Limits Misconfiguration)

## Notes

**Context from Code:**
- `src/risk_layer/kill_switch/` is very well documented (Layer 4, Defense-in-Depth)
- `src/risk_layer/` appears to be newer, more structured
- `src/risk/` may be legacy or may serve different purpose (e.g., backtest risk vs live risk)

**This is not necessarily a bug**, but a clarity/documentation gap that could lead to errors.

## Revision History

| Date | Author | Changes |
|------|--------|---------|
| 2025-12-30 | Audit Agent A | Initial finding |
