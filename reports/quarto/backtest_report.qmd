---
title: "Peak_Trade Backtest Report"
format:
  html:
    embed-resources: true
    toc: true
    toc-depth: 2
    code-fold: true
    theme: cosmo
execute:
  enabled: false
---

# Overview

This is an automated backtest report generated by Peak_Trade's Evidence Chain (P1).

## Run Information

```{=html}
<!-- Run metadata will be injected here from config_snapshot.json -->
<div id="run-meta">
<p><strong>Report generated:</strong> {{< meta date >}}</p>
</div>
```

## Configuration

The complete configuration snapshot is available in `config_snapshot.json`.

### Strategy Parameters

```{python}
#| echo: false
import json
from pathlib import Path

# Load config snapshot
config_path = Path("_run/config_snapshot.json")
if config_path.exists():
    with open(config_path) as f:
        config = json.load(f)

    print("**Meta:**")
    for k, v in config.get("meta", {}).items():
        print(f"- {k}: `{v}`")

    print("\n**Parameters:**")
    for k, v in config.get("params", {}).items():
        print(f"- {k}: `{v}`")
else:
    print("⚠️ config_snapshot.json not found")
```

## Performance Summary

```{python}
#| echo: false
import json
from pathlib import Path

# Load stats
stats_path = Path("_run/stats.json")
if stats_path.exists():
    with open(stats_path) as f:
        stats = json.load(f)

    print("### Key Metrics")
    print("")

    # Format key metrics
    metrics = {
        "Total Return": ("total_return", ".2%"),
        "Sharpe Ratio": ("sharpe", ".2f"),
        "Max Drawdown": ("max_drawdown", ".2%"),
        "Total Trades": ("total_trades", "d"),
        "Win Rate": ("win_rate", ".2%"),
        "Profit Factor": ("profit_factor", ".2f"),
    }

    for label, (key, fmt) in metrics.items():
        if key in stats:
            value = stats[key]
            if value is not None:
                formatted = f"{value:{fmt}}" if isinstance(value, (int, float)) else str(value)
                print(f"- **{label}:** {formatted}")
else:
    print("⚠️ stats.json not found")
```

## Equity Curve

```{python}
#| echo: false
#| fig-width: 10
#| fig-height: 6
import pandas as pd
from pathlib import Path
import matplotlib.pyplot as plt

equity_path = Path("_run/equity.csv")
if equity_path.exists():
    df_equity = pd.read_csv(equity_path)

    if "timestamp" in df_equity.columns and "equity" in df_equity.columns:
        # Convert timestamp to datetime if needed
        if df_equity["timestamp"].dtype == "object":
            df_equity["timestamp"] = pd.to_datetime(df_equity["timestamp"])

        # Plot
        fig, ax = plt.subplots(figsize=(10, 6))
        ax.plot(df_equity["timestamp"], df_equity["equity"], linewidth=2, color="#2E86AB")
        ax.set_xlabel("Time")
        ax.set_ylabel("Equity")
        ax.set_title("Equity Curve")
        ax.grid(True, alpha=0.3)
        plt.xticks(rotation=45)
        plt.tight_layout()
        plt.show()
    else:
        print("⚠️ equity.csv missing required columns (timestamp, equity)")
else:
    print("⚠️ equity.csv not found")
```

## Detailed Statistics

```{python}
#| echo: false
import json
from pathlib import Path

stats_path = Path("_run/stats.json")
if stats_path.exists():
    with open(stats_path) as f:
        stats = json.load(f)

    print("### All Metrics")
    print("")

    # Display all stats
    for key, value in sorted(stats.items()):
        print(f"- **{key}:** {value}")
else:
    print("⚠️ stats.json not found")
```

## Report Snippet

```{python}
#| echo: false
from pathlib import Path

snippet_path = Path("_run/report_snippet.md")
if snippet_path.exists():
    with open(snippet_path) as f:
        snippet = f.read()
    print(snippet)
else:
    print("⚠️ report_snippet.md not found")
```

---

## Notes

- This report is generated with `execute: enabled: false`, meaning no code is executed during rendering.
- All data is pre-computed and loaded from artifacts in the `_run/` directory.
- To regenerate this report, use: `bash scripts/render_last_report.sh [run_id]`

**Report Template Version:** P1 Evidence Chain v1.0
