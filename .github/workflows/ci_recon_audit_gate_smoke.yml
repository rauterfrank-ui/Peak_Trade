name: Recon Audit Gate Smoke

on:
  pull_request:
    paths:
      - "scripts/execution/recon_audit_gate.sh"
      - "scripts/ci/recon_audit_gate_smoke.sh"
      - "src/execution/**"
      - "pyproject.toml"
      - "uv.lock"
      - ".github/workflows/**"
  push:
    branches: ["main"]
    paths:
      - "scripts/execution/recon_audit_gate.sh"
      - "scripts/ci/recon_audit_gate_smoke.sh"
      - "src/execution/**"
      - "pyproject.toml"
      - "uv.lock"
      - ".github/workflows/ci_recon_audit_gate_smoke.yml"
  workflow_dispatch: {}

jobs:
  recon-audit-gate-smoke:
    name: Recon Audit Gate Smoke
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install uv
        run: python -m pip install --upgrade pip uv

      - name: Sync deps (locked)
        run: |
          if [ -f uv.lock ]; then
            uv sync --locked --dev
          else
            uv sync --dev
          fi

      - name: Install shellcheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck

      - name: Run shellcheck
        run: |
          shellcheck scripts/execution/recon_audit_gate.sh
          shellcheck scripts/ci/recon_audit_gate_smoke.sh

      - name: Run wrapper smoke
        run: bash scripts/ci/recon_audit_gate_smoke.sh
