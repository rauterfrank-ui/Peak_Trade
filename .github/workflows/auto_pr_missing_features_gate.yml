name: Auto-create PR (missing-features-and-ai-matrix-gate)

on:
  push:
    branches:
      - feat/missing-features-and-ai-matrix-gate

permissions:
  contents: read
  pull-requests: write

jobs:
  create_pr:
    runs-on: ubuntu-latest
    steps:
      - name: Create PR if missing
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const branch = context.ref.replace('refs/heads/', '');
            const base = 'main';
            const head = `${owner}:${branch}`;

            const existing = await github.rest.pulls.list({
              owner, repo, state: 'open', base, head
            });

            if (existing.data.length > 0) {
              core.info(`PR already exists: ${existing.data[0].html_url}`);
              return;
            }

            const title = 'docs+governance: runbook index, missing-features sync, ai matrix gate';
            const body = [
              '## Summary',
              '',
              '- Add/index Cursor MA runbook for open points (Aâ€“J).',
              '- Sync missing-features doc to current repo state.',
              '- Refine ai_matrix_consistency_gate.',
              '',
              '## Validation',
              '- Guardrails confirmed: only expected paths changed (docs + governance gate).',
              '',
              '_Details: see commit list and file diff._'
            ].join('\n');

            const pr = await github.rest.pulls.create({
              owner, repo, title, head: branch, base, body, maintainer_can_modify: true
            });

            core.info(`PR created: ${pr.data.html_url}`);
