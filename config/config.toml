# ============================================================================
# Peak_Trade Konfiguration
# ============================================================================
# Stand: Dezember 2024
# WICHTIG: Keine Secrets hier! API-Keys gehören in .env oder Umgebungsvariablen
# ============================================================================

# ============================================================================
# PHASE 79: REAL-MARKET SMOKES CONFIGURATION
# ============================================================================
# Konfiguration für Real-Market-Smoke-Tests mit lokalem Kraken-Cache.
# WICHTIG: Rein Offline - keine Netzwerk-Calls, nur lokale Parquet-Dateien!
# ============================================================================

[real_market_smokes]
# Basis-Pfad für Kraken-Cache-Files (Produktiv)
base_path = "data/cache"

# Override-Base für Tests (in pytest über Fixture gesetzt)
test_base_path = "tests/data/kraken_smoke"

# Default-Parameter für Real-Market-Smokes
default_market = "BTC/EUR"
default_timeframe = "1h"
default_lookback_days = 30

# Data-Quality-Control Thresholds
min_bars = 500

# Liste konfigurierter Real-Market-Szenarien
markets = ["BTC/EUR"]
timeframes = ["1h"]

[backtest]
# Startkapital für Backtests
initial_cash = 10000.0

# Verzeichnis für Backtest-Ergebnisse
results_dir = "results"

[risk]
# ===== Position Sizing =====
# Methode: "fixed_fractional" oder "kelly"
position_sizing_method = "fixed_fractional"

# Maximales Risiko pro Trade (1% = 0.01)
# KRITISCH: Niemals über 2% gehen!
risk_per_trade = 0.01

# Maximale Positionsgröße (% des Kontos)
# NIEMALS über 50% einer einzelnen Position!
max_position_size = 0.25

# Minimaler Positionswert in USD
# Verhindert zu kleine Positionen (Gebühren!)
min_position_value = 50.0

# Minimale Stop-Distanz (%)
# Zu enge Stops = Noise-Trading
min_stop_distance = 0.005

# Kelly-Criterion Scaling (nur wenn method="kelly")
# Typisch: 0.25 - 0.5 (konservativ)
kelly_scaling = 0.5

# ===== Portfolio Risk Limits =====
# Maximaler Tagesverlust (Kill-Switch)
# Bei Erreichen: Alle Positionen schließen, Trading stoppen
max_daily_loss = 0.03

# Maximaler Portfolio-Drawdown
# Überschreitung führt zu Trading-Stop
max_drawdown = 0.20

# Maximale Anzahl paralleler Positionen
max_positions = 2

# Maximales Gesamt-Exposure (Summe aller Positionswerte / Equity)
max_total_exposure = 0.75

[data]
# Standard-Timeframe für OHLCV-Daten
default_timeframe = "1h"

# Daten-Verzeichnis (nicht ins Repo!)
data_dir = "data"

# Cache-Settings
use_cache = true
cache_format = "parquet"

# ============================================================================
# STRATEGIEN-REGISTRY (Zentrale Verwaltung aller Strategien)
# ============================================================================
[strategies]
# Liste aller aktuell AKTIVEN Strategien für Backtests/Portfolio
# Reihenfolge = Priorität im Portfolio-Allokations-Algorithmus
active = ["ma_crossover", "momentum_1h", "rsi_strategy"]

# Alle verfügbaren Strategien (Dokumentation / Discovery)
# Strategien in dieser Liste müssen einen [strategy.NAME]-Block haben
available = [
    "ma_crossover",
    "momentum_1h",
    "rsi_strategy",
    "bollinger_bands",
    "macd",
    "ecm_cycle"
]

# ============================================================================
# PHASE 75: v1.1 CURATED STRATEGIES
# ============================================================================
# Kuratierte Strategien für v1.1 mit einheitlicher Config-Struktur.
# Diese ersetzen die Legacy-Configs für Production-Use.
# ============================================================================

# --- v1.1 TREND-FOLLOWING STRATEGIES ---

[strategies.ma_crossover]
enabled = true
category = "trend"
timeframes = ["1h", "4h", "1d"]
risk_level = "medium"
description = "Moving Average Crossover Strategy (Fast/Slow MA)"
v11_official = true

[strategies.ma_crossover.defaults]
fast_window = 20
slow_window = 50
price_col = "close"

[strategies.trend_following]
enabled = true
category = "trend"
timeframes = ["1h", "4h", "1d"]
risk_level = "medium"
description = "ADX-basierte Trend-Following-Strategie mit optionalem MA-Filter"
v11_official = true

[strategies.trend_following.defaults]
adx_period = 14
adx_threshold = 25.0
exit_threshold = 20.0
ma_period = 50
use_ma_filter = true

[strategies.macd]
enabled = true
category = "trend"
timeframes = ["4h", "1d"]
risk_level = "medium"
description = "MACD Trend-Following (EMA-Crossover)"
v11_official = true

[strategies.macd.defaults]
fast_ema = 12
slow_ema = 26
signal_ema = 9

# --- v1.1 MEAN-REVERSION STRATEGIES ---

[strategies.rsi_reversion]
enabled = true
category = "mean_reversion"
timeframes = ["15m", "1h", "4h"]
risk_level = "medium"
description = "RSI Mean-Reversion mit optionalem Trendfilter"
v11_official = true

[strategies.rsi_reversion.defaults]
rsi_window = 14
lower = 30.0
upper = 70.0
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false
trend_ma_window = 50
use_wilder = true
price_col = "close"

[strategies.mean_reversion]
enabled = true
category = "mean_reversion"
timeframes = ["1h", "4h"]
risk_level = "medium"
description = "Z-Score Mean-Reversion mit optionalem Volatilitaetsfilter"
v11_official = true

[strategies.mean_reversion.defaults]
lookback = 20
entry_threshold = -2.0
exit_threshold = 0.0
use_vol_filter = false
vol_window = 20
max_vol_percentile = 70.0

[strategies.bollinger_bands]
enabled = true
category = "mean_reversion"
timeframes = ["1h", "4h", "1d"]
risk_level = "medium"
description = "Bollinger Bands Mean-Reversion"
v11_official = true

[strategies.bollinger_bands.defaults]
bb_period = 20
bb_std = 2.0
entry_threshold = 0.95
exit_threshold = 0.50

# --- v1.1 MOMENTUM STRATEGIES ---

[strategies.momentum_1h]
enabled = true
category = "momentum"
timeframes = ["1h", "4h"]
risk_level = "medium_high"
description = "Momentum-basierte Trend-Following-Strategie"
v11_official = true

[strategies.momentum_1h.defaults]
lookback_period = 20
entry_threshold = 0.02
exit_threshold = -0.01

# --- v1.1 BREAKOUT STRATEGIES ---

[strategies.breakout]
enabled = true
category = "breakout"
timeframes = ["1h", "4h"]
risk_level = "medium_high"
description = "N-Bar Breakout mit SL/TP, Trailing-Stop und ATR-Filter"
v11_official = true

[strategies.breakout.defaults]
lookback_breakout = 20
atr_lookback = 14
use_atr_filter = false
exit_on_opposite_breakout = true
risk_mode = "symmetric"
stop_loss_pct = 0.03
take_profit_pct = 0.06
price_col = "close"

# --- v1.1 META/FILTER STRATEGIES ---

[strategies.vol_regime_filter]
enabled = true
category = "meta"
timeframes = ["1h", "4h"]
risk_level = "-"
description = "Volatilitaets-Regime-Filter (Overlay fuer andere Strategien)"
v11_official = true

[strategies.vol_regime_filter.defaults]
vol_window = 14
vol_method = "atr"
vol_percentile_low = 25
vol_percentile_high = 75
lookback_percentile = 100
min_bars = 30
regime_mode = false
invert = false

# --- EXPERIMENTAL (nicht v1.1-offiziell) ---

[strategies.composite]
enabled = false
category = "meta"
timeframes = []
risk_level = "varies"
description = "Multi-Strategy Composite (experimental)"
v11_official = false

[strategies.regime_aware_portfolio]
enabled = false
category = "meta"
timeframes = []
risk_level = "varies"
description = "Regime-Aware Portfolio Strategy (experimental)"
v11_official = false

# Default-Parameter für ALLE Strategien (sofern nicht überschrieben)
[strategies.defaults]
# Risk Management Defaults
stop_pct = 0.02              # Standard Stop-Loss: 2%
take_profit_pct = 0.05       # Standard Take-Profit: 5%
use_trailing_stop = false    # Trailing-Stop aktivieren?
trailing_stop_pct = 0.015    # Trailing-Stop-Distanz: 1.5%

# Position Sizing Defaults
position_fraction = 0.25     # 25% des Kapitals pro Trade
min_position_value = 50.0    # Min. Tradegröße in USD (überschreibt [risk])

# Lifecycle / Timing Defaults
min_hold_bars = 3            # Min. Haltedauer in Bars (verhindert Over-Trading)
max_hold_bars = 100          # Max. Haltedauer (Timeout-Exit nach N Bars)
warmup_bars = 200            # Min. Bars für Indikator-Initialisierung

# Circuit Breakers
max_consecutive_losses = 3   # Kill-Switch nach N Verlusten in Folge
cooldown_after_stop = 5      # Bars Pause nach Stop-Loss-Trigger

# Strategien-Metadaten (für Analyse/Reporting)
[strategies.metadata]
# Strategie-Typ-Kategorisierung
[strategies.metadata.ma_crossover]
type = "trend_following"
risk_level = "medium"
best_market_regime = "trending"
recommended_timeframes = ["1h", "4h", "1d"]

[strategies.metadata.momentum_1h]
type = "trend_following"
risk_level = "medium_high"
best_market_regime = "trending"
recommended_timeframes = ["1h", "4h"]

[strategies.metadata.rsi_strategy]
type = "mean_reversion"
risk_level = "medium"
best_market_regime = "ranging"
recommended_timeframes = ["15m", "1h", "4h"]

[strategies.metadata.bollinger_bands]
type = "mean_reversion"
risk_level = "medium"
best_market_regime = "ranging"
recommended_timeframes = ["1h", "4h", "1d"]

[strategies.metadata.macd]
type = "trend_following"
risk_level = "medium"
best_market_regime = "trending"
recommended_timeframes = ["4h", "1d"]

[strategies.metadata.ecm_cycle]
type = "macro_cycle"
risk_level = "low"
best_market_regime = "any"
recommended_timeframes = ["1d", "1w"]

# ============================================================================
# STRATEGIE-SPEZIFISCHE PARAMETER (bestehende Blöcke - UNVERÄNDERT)
# ============================================================================

[strategy.ma_crossover]
# Moving Average Crossover Parameter
fast_period = 10
slow_period = 30

# Stop-Loss in Prozent
stop_pct = 0.02

# Optional: Take-Profit
# take_profit_pct = 0.05

[live]
# WARNUNG: Nur für Paper-Trading verwenden!
# Live-Trading NIEMALS ohne min. 6 Monate erfolgreiche Backtests!
enabled = false
mode = "paper"  # "paper" oder "live" (GEFÄHRLICH!)

# Kraken API (Keys NICHT hier speichern!)
# Verwende Umgebungsvariablen: KRAKEN_API_KEY, KRAKEN_API_SECRET
exchange = "kraken"
default_pair = "BTC/USD"

[validation]
# Mindestanforderungen für Live-Trading-Freigabe
min_sharpe = 1.5
max_drawdown = -0.15
min_trades = 50
min_profit_factor = 1.3
min_backtest_months = 6

[strategy.momentum_1h]
# Momentum-Strategie basierend auf Kursänderung über N Perioden
lookback_period = 20      # Lookback-Fenster für Momentum
entry_threshold = 0.02    # Min. 2% Momentum für Entry
exit_threshold = -0.01    # Exit bei -1% Momentum
stop_pct = 0.025          # 2.5% Stop-Loss


[portfolio]
# Multi-Strategy-Portfolio-Einstellungen
enabled = true
max_strategies_active = 3     # Max. gleichzeitig aktive Strategien
min_correlation = -0.3        # Min. Korrelation zwischen Strategien
rebalance_frequency = 24      # Rebalancing alle N Bars

# Capital Allocation
allocation_method = "equal"   # "equal", "risk_parity", "sharpe_weighted"
total_capital = 10000.0       # Gesamtkapital für Portfolio

# Portfolio-Level Risk
portfolio_max_dd = -0.20      # Max. Portfolio-Drawdown (20%)
portfolio_stop_loss = -0.05   # Daily Portfolio Stop-Loss (5%)

# Strategy Weights (bei manueller Allocation)
[portfolio.weights]
ma_crossover = 0.33
momentum_1h = 0.33
rsi_strategy = 0.34

[strategy.rsi_strategy]
# RSI Mean-Reversion-Strategie
rsi_period = 14          # RSI-Berechnungsperiode
oversold = 30            # Oversold-Level (Entry)
overbought = 70          # Overbought-Level (Exit)
stop_pct = 0.02          # 2% Stop-Loss

[strategy.bollinger_bands]
# Bollinger Bands Mean-Reversion
bb_period = 20           # Periode für Moving Average
bb_std = 2.0             # Standard-Abweichungen (2 = 95%)
entry_threshold = 0.95   # Entry bei 95% der unteren Band
exit_threshold = 0.50    # Exit bei Mittel-Band
stop_pct = 0.03          # 3% Stop-Loss

[strategy.macd]
# MACD Trend-Following
fast_ema = 12            # Schnelle EMA
slow_ema = 26            # Langsame EMA
signal_ema = 9           # Signal-Linie
entry_threshold = 0.0    # Entry bei MACD > Signal
exit_threshold = 0.0     # Exit bei MACD < Signal
stop_pct = 0.025         # 2.5% Stop-Loss

[strategy.ecm_cycle]
# ECM (Economic Confidence Model) - Armstrong's 8.6 Year Cycle
ecm_cycle_days = 3141        # Pi * 1000 Tage (8.6 Jahre)
ecm_confidence_threshold = 0.6  # Confidence-Level für Entry
lookback_bars = 100          # Lookback für Trend-Bestimmung
use_pi_harmonics = true      # Pi-Harmonics verwenden (1/4, 1/2, 3/4)
stop_pct = 0.03              # 3% Stop-Loss

# ECM-Turning-Points (beispielhaft - später aus docs/armstrong_notes.md)
# Format: YYYY-MM-DD
ecm_reference_date = "2020-01-18"  # Letzter bekannter ECM-Peak

# ============================================================================
# PHASE 40+: STRATEGY LIBRARY ERWEITERUNGEN (Breakout & Vol-Regime)
# ============================================================================

# Neue Breakout-Variante mit erweiterten Features
[strategy.breakout_basic]
type = "breakout"
lookback_high = 20
lookback_low = 20
atr_lookback = 14
atr_multiplier = 1.0
use_atr_filter = true
exit_on_opposite_breakout = true
risk_mode = "symmetric"
price_col = "close"

# Vol-Regime-Filter mit Threshold-basierter Klassifikation
[strategy.vol_regime_basic]
type = "vol_regime_filter"
vol_lookback = 20            # Alias für vol_window
vol_metric = "atr"           # Alias für vol_method
low_vol_threshold = 0.5      # Vol < threshold → Regime = 1 (Risk-On)
high_vol_threshold = 2.0     # Vol > threshold → Regime = -1 (Risk-Off)
min_bars = 30                # Minimum an Bars vor Klassifikation
regime_mode = true           # Aktiviert Regime-Modus (1/-1/0 statt 1/0)

# ============================================================================
# PHASE 40: STRATEGY LIBRARY ERWEITERUNGEN (Legacy)
# ============================================================================

[strategy.breakout]
# Breakout/Momentum Strategy mit Stop-Loss und Take-Profit
lookback_breakout = 20       # Standard-Lookback-Fenster für Hoch/Tief
# lookback_high = 20        # Optional: Separates Lookback für Long-Breakout
# lookback_low = 20         # Optional: Separates Lookback für Short-Breakout
# ATR-Filter Optionen
atr_lookback = 14            # ATR-Fenster für Filter
# atr_multiplier = 1.0      # Optional: Mindest-ATR-Level (ATR > multiplier * Baseline)
use_atr_filter = false       # ATR-Filter aktivieren/deaktivieren
exit_on_opposite_breakout = true  # Exit bei gegenteiligem Breakout
risk_mode = "symmetric"      # "symmetric", "long_only", "short_only"
# Legacy: side (wird zu risk_mode gemappt)
side = "both"                # "long", "short" oder "both" (Legacy, bevorzugt risk_mode)
stop_loss_pct = 0.03         # Stop-Loss: 3%
take_profit_pct = 0.06       # Take-Profit: 6%
# trailing_stop_pct = 0.02   # Optional: Trailing-Stop (2%)
price_col = "close"

[strategy.vol_regime_filter]
# Volatilitäts-Regime-Filter
# Erlaubt Trades nur wenn Volatilität im definierten Bereich liegt
# ODER gibt Regime-Signale zurück (Low-Vol/High-Vol/Neutral)
vol_window = 14              # ATR/Volatility-Berechnung Fenster
vol_method = "atr"           # "atr", "std", "realized" oder "range"
# Threshold-basierte Regime-Klassifikation
# low_vol_threshold = 0.5    # Optional: Vol < threshold → Regime = 1 (Risk-On)
# high_vol_threshold = 2.0   # Optional: Vol > threshold → Regime = -1 (Risk-Off)
min_bars = 30                # Minimum an Bars vor Klassifikation
regime_mode = false          # Wenn true: gibt Regime-Signale (1/-1/0) statt Filter (1/0)
# Perzentil-basierter Filter (alternativ)
vol_percentile_low = 25      # Trading nur wenn Vol > 25. Perzentil
vol_percentile_high = 75     # Trading nur wenn Vol < 75. Perzentil
lookback_percentile = 100    # Lookback für Perzentil-Berechnung
# Absolute Thresholds (alternativ)
# min_vol = 50.0             # Optional: Absoluter Min-Vol-Schwellwert
# max_vol = 500.0            # Optional: Absoluter Max-Vol-Schwellwert
# atr_threshold = 100.0      # Optional: ATR muss > Threshold sein
invert = false               # Invertiert die Filterlogik

[strategy.rsi_reversion_v1]
# RSI Mean-Reversion (erweitertes Beispiel)
rsi_window = 14
lower = 30.0                 # Oversold-Level für Long
upper = 70.0                 # Overbought-Level für Short
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false     # Optional: MA-Trendfilter
trend_ma_window = 50
use_wilder = true            # Wilder-Smoothing (stabiler)
price_col = "close"

[strategy.breakout_v1]
# Breakout-Strategie Beispiel-Config
lookback_breakout = 15
stop_loss_pct = 0.025        # 2.5% Stop-Loss
take_profit_pct = 0.05       # 5% Take-Profit
trailing_stop_pct = 0.02     # 2% Trailing-Stop
side = "long"                # Nur Long-Trades
price_col = "close"

[strategy.composite]
# Multi-Strategy Composite (Kombiniert mehrere Strategien)
components = ["rsi_reversion", "breakout"]
weights = [0.5, 0.5]
aggregation = "weighted"     # "weighted", "voting", "unanimous", "any_long", "any_short"
signal_threshold = 0.3       # Long wenn > 0.3, Short wenn < -0.3
require_all_valid = false
# filter = "vol_regime_filter"  # Optional: Filter-Strategie

[strategy.portfolio_phase40_example]
# Beispiel-Portfolio für Phase 40
components = ["rsi_reversion", "breakout", "ma_crossover"]
weights = [0.4, 0.3, 0.3]
aggregation = "weighted"
signal_threshold = 0.25

# ============================================================================
# REGIME-AWARE PORTFOLIO STRATEGIES (Phase XX)
# ============================================================================

[portfolio.regime_aware_breakout_rsi]
# Regime-Aware Portfolio: Breakout + RSI mit Vol-Regime-Filter
type = "regime_aware_portfolio"
components = ["breakout", "rsi_reversion"]
base_weights = { breakout = 0.6, rsi_reversion = 0.4 }
regime_strategy = "vol_regime_filter"
mode = "scale"              # "scale" oder "filter"
risk_on_scale = 1.0         # Volle Gewichte bei Risk-On
neutral_scale = 0.5         # Halbe Gewichte bei Neutral
risk_off_scale = 0.0        # Keine Gewichte bei Risk-Off
signal_threshold = 0.3      # Schwelle für Long/Short-Entscheidung

[portfolio.regime_aware_conservative]
# Konservatives Regime-Aware Portfolio (nur Risk-On)
type = "regime_aware_portfolio"
components = ["breakout", "ma_crossover"]
base_weights = { breakout = 0.5, ma_crossover = 0.5 }
regime_strategy = "vol_regime_filter"
mode = "filter"             # Filter-Mode: Risk-Off → Flat
risk_on_scale = 1.0
neutral_scale = 0.3         # Sehr reduzierte Gewichte bei Neutral
risk_off_scale = 0.0
signal_threshold = 0.25

# ============================================================================
# PHASE 31: SHADOW/PAPER LIVE-SESSION CONFIGURATION
# ============================================================================
# Konfiguration für Shadow-/Paper-Trading mit echten Exchange-Marktdaten.
# WICHTIG: Es werden KEINE echten Orders an die Exchange gesendet!
#          Nur public market data wird verwendet.
# ============================================================================

[shadow_paper]
# Shadow-/Paper-Session aktivieren
enabled = true

# Modus: "shadow" oder "paper"
# - shadow: Strategie läuft parallel, Orders werden nur geloggt
# - paper: Vollständige Paper-Trading-Simulation
mode = "paper"

# Trading-Symbol (Kraken-Format)
symbol = "BTC/EUR"

# Timeframe für Candles ("1m", "5m", "15m", "1h", "4h", "1d")
timeframe = "1m"

# Polling-Intervall in Sekunden (wie oft neue Daten geholt werden)
poll_interval_seconds = 60.0

# Anzahl Warmup-Candles für Indikator-Initialisierung
warmup_candles = 200

# Start-Balance für Paper-Trading in EUR
start_balance = 10000.0

# Position-Sizing: Anteil des Kapitals pro Trade (0.0 - 1.0)
position_fraction = 0.1

# Fee-Rate für Simulation (z.B. 0.0026 = 26 bps = 0.26%)
fee_rate = 0.0026

# Slippage in Basispunkten für Simulation
slippage_bps = 5.0

[live_exchange]
# Exchange-Konfiguration für Live-Marktdaten
# WICHTIG: Nur public market data! Keine Order-APIs!
name = "kraken"

# Sandbox/Public-Only Modus (MUSS true sein für Phase 31)
use_sandbox = true

# Basis-URL für Kraken Public API
base_url = "https://api.kraken.com"

# Rate-Limit-Einstellungen
rate_limit_ms = 1000

# Retry-Einstellungen bei Netzwerkfehlern
max_retries = 3
retry_delay_seconds = 5.0

# ============================================================================
# LIVE RISK LIMITS (Phase 31 - Shadow/Paper spezifisch)
# ============================================================================

[live_alerts]
# Live Alerts & Notifications (Phase 49 + 50)
# ============================================
# Konfiguration für Alert-System bei Risk-Violations und kritischen Zuständen.
#
# enabled: Ob Alerts aktiviert sind
# min_level: Minimaler Alert-Level ("info", "warning", "critical")
# sinks: Liste der aktiven Sink-Namen (z.B. ["log", "stderr", "webhook", "slack_webhook"])
# log_logger_name: Logger-Name für Logging-Sink
# webhook_urls: Liste von generischen HTTP-Webhook-URLs (Phase 50)
# slack_webhook_urls: Liste von Slack-Webhook-URLs (Phase 50)
# webhook_timeout_seconds: Timeout für HTTP-Requests in Sekunden (Phase 50)
enabled = true
min_level = "warning"
sinks = ["log"]
log_logger_name = "peak_trade.live.alerts"

# Phase 50: Webhook & Slack
webhook_urls = []
slack_webhook_urls = []
webhook_timeout_seconds = 3.0

[live_risk]
# Live-Risk-Limits aktivieren
enabled = true

# Basis-Währung für Limits
base_currency = "EUR"

# Maximales Notional pro einzelner Order (EUR)
max_order_notional = 1000.0

# Max. aggregiertes Notional pro Symbol (EUR)
max_symbol_exposure_notional = 2000.0

# Max. Gesamt-Notional aller Orders (EUR)
max_total_exposure_notional = 5000.0

# Max. Anzahl verschiedener Symbole/Positionen
max_open_positions = 5

# Absoluter max. Tagesverlust (EUR)
max_daily_loss_abs = 500.0

# Prozentualer max. Tagesverlust (bezogen auf start_balance)
max_daily_loss_pct = 5.0

# Bei Limit-Verletzung Orders blockieren
block_on_violation = true

# Tages-PnL aus Experiments-Registry verwenden
use_experiments_for_daily_pnl = true

# ============================================================================
# ENVIRONMENT CONFIGURATION (Safety Layer)
# ============================================================================

[environment]
# Trading-Umgebung: "paper", "testnet", "live"
# WICHTIG: Für Phase 31 NUR "paper" verwenden!
mode = "paper"

# Live-Trading explizit deaktivieren (Safety)
enable_live_trading = false

# Bestätigungs-Token für Live-Trading erforderlich
require_confirm_token = true

# Testnet Dry-Run Modus (Safety)
testnet_dry_run = true

# Alle Orders loggen
log_all_orders = true

# ============================================================================
# PHASE 32: SHADOW/PAPER RUN LOGGING CONFIGURATION
# ============================================================================
# Konfiguration für das Logging von Shadow-/Paper-Runs.
# Erzeugt strukturierte Logs für jeden Run, die für Reporting verwendet werden.
# ============================================================================

[shadow_paper_logging]
# Run-Logging aktivieren
enabled = true

# Basis-Verzeichnis für Run-Logs
base_dir = "live_runs"

# Flush-Intervall (alle N Steps werden Events persistiert)
flush_interval_steps = 50

# Format für Events-Datei ("parquet" oder "csv")
format = "parquet"

# Automatisch Markdown-Report beim Beenden generieren
write_markdown_report_on_finish = false

# Detailliertes Event-Logging (inkl. OHLC pro Step)
log_ohlc_details = true

# Order-Details loggen (Side, Size, Price, etc.)
log_order_details = true

# Risk-Check-Details loggen (Reasons, Metrics)
log_risk_details = true

# ============================================================================
# PHASE 33: LIVE MONITORING CONFIGURATION
# ============================================================================
# Konfiguration für das CLI-Monitoring von Shadow-/Paper-Runs.
# Erlaubt Echtzeit-Beobachtung laufender Sessions.
# ============================================================================

[live_monitoring]
# Standard-Refresh-Intervall in Sekunden
default_interval_seconds = 2.0

# Anzahl der Tail-Zeilen (letzte Events)
default_tail_rows = 15

# ANSI-Farben im Terminal verwenden
use_colors = true

# ============================================================================
# PHASE 34: ALERTS CONFIGURATION
# ============================================================================
# Alert-System für Shadow-/Paper-Runs.
# Generiert Warnungen bei Risk-Verletzungen, großen Verlusten etc.
# ============================================================================

[alerts]
# Alerts aktivieren
enabled = true

# Minimale Severity für Alerts ("info", "warning", "critical")
min_severity = "warning"

# Sekunden zwischen gleichen Alerts (Debouncing)
debounce_seconds = 60

[alerts.rules]
# Risk-Blocked-Regel (orders durch Risk-Limits blockiert)
enable_risk_blocked = true

# Absolute Verlust-Regel
enable_large_loss_abs = true
large_loss_abs_threshold = -500.0

# Prozentuale Verlust-Regel
enable_large_loss_pct = true
large_loss_pct_threshold = -10.0

# Drawdown-Regel (aktuell deaktiviert, da nicht im Snapshot)
enable_drawdown = false
drawdown_threshold = -15.0

# ============================================================================
# PHASE 34: WEB UI CONFIGURATION
# ============================================================================
# Einfache Web-UI für Run-Monitoring (lokal).
# ============================================================================

[web_ui]
# Web-UI aktivieren
enabled = true

# Host für den Web-Server
host = "127.0.0.1"

# Port für den Web-Server
port = 8000

# Auto-Refresh-Intervall im Browser (Sekunden)
auto_refresh_seconds = 5

# ============================================================================
# PHASE 38: EXCHANGE CLIENT CONFIGURATION
# ============================================================================
# Konfiguration für den Exchange-Client-Layer.
# default_type bestimmt, welcher Client für Trading verwendet wird.
#
# Verfügbare Typen:
# - "dummy": In-Memory-Client für Tests (keine echten API-Calls)
# - "kraken_testnet": Kraken Testnet/Demo-API
# - (später) "kraken_live": Echte Kraken-API
# ============================================================================

[exchange]
# Standard-Client-Typ für Trading
default_type = "dummy"

# Dummy-Client Einstellungen (nur wenn default_type = "dummy")
[exchange.dummy]
btc_eur_price = 50000.0
eth_eur_price = 3000.0
btc_usd_price = 55000.0
fee_bps = 10.0
slippage_bps = 5.0

# ============================================================================
# PHASE 35: TESTNET EXCHANGE INTEGRATION
# ============================================================================
# Konfiguration fuer die Testnet-/Demo-Exchange-Integration.
# WICHTIG: Dies ist KEIN echtes Live-Trading! Nur Testnet/Demo-Modus.
#
# Sicherheitshinweise:
# - API-Keys werden NUR aus Environment-Variablen gelesen
# - Default: validate_only=true (Orders werden nur validiert, nicht ausgefuehrt)
# - Echtes Live-Trading erfordert weitere Phasen (40+)
# ============================================================================

[exchange.kraken_testnet]
# Testnet-Integration aktivieren
enabled = true

# Kraken API Base-URL
# Hinweis: Kraken hat kein echtes Testnet, daher nutzen wir validate_only=true
base_url = "https://api.kraken.com"

# Environment-Variable fuer den API-Key (NICHT der Key selbst!)
api_key_env_var = "KRAKEN_TESTNET_API_KEY"

# Environment-Variable fuer das API-Secret (NICHT das Secret selbst!)
api_secret_env_var = "KRAKEN_TESTNET_API_SECRET"

# WICHTIG: validate_only=true bedeutet:
# - Orders werden an die API geschickt und validiert
# - Orders werden NICHT tatsaechlich ausgefuehrt
# - Ideal fuer Tests ohne echtes Kapitalrisiko
# Setze auf false NUR wenn du echte Testnet-Orders willst!
validate_only = true

# HTTP-Request Timeout in Sekunden
timeout_seconds = 30.0

# Max. Retries bei Netzwerkfehlern
max_retries = 3

# Rate-Limit: Mindestabstand zwischen Requests in Millisekunden
rate_limit_ms = 1000

# ============================================================================
# TESTNET SESSION CONFIGURATION (Phase 35)
# ============================================================================
# Konfiguration fuer Testnet-Trading-Sessions.
# Analog zu shadow_paper, aber mit echten (Testnet-)Orders.
# ============================================================================

[testnet_session]
# Testnet-Sessions aktivieren
enabled = true

# Default-Exchange fuer Testnet
default_exchange = "kraken_testnet"

# Trading-Symbol (muss vom Exchange unterstuetzt werden)
symbol = "BTC/EUR"

# Timeframe fuer Candles
timeframe = "1m"

# Polling-Intervall in Sekunden
poll_interval_seconds = 60.0

# Anzahl Warmup-Candles
warmup_candles = 200

# Start-Balance fuer Tracking (informativ, wird nicht von Exchange gelesen)
start_balance = 10000.0

# Position-Sizing: Anteil des Kapitals pro Trade
position_fraction = 0.1

# Simulierte Fee-Rate fuer PnL-Tracking (tatsaechliche Fees kommen vom Exchange)
fee_rate = 0.0026

# Simulierte Slippage in bps (fuer Vergleich mit realem Fill)
slippage_bps = 5.0

# ============================================================================
# PHASE 37: TESTNET LIMITS & BUDGETS
# ============================================================================
# Kontrollierte Testnet-Limits fuer planbare, reproduzierbare Testlaeufe.
# Diese Limits ergaenzen die LiveRiskLimits um eine zusaetzliche Schicht.
#
# WICHTIG: Diese Limits gelten nur fuer Testnet-Trading, nicht fuer Live!
# ============================================================================

[testnet_limits.run]
# Limits pro einzelnem Testnet-Run
max_notional_per_run = 1000.0    # Max. Handelsvolumen pro Run (EUR)
max_trades_per_run = 50         # Max. Anzahl Trades pro Run
max_duration_minutes = 240      # Max. Laufzeit pro Run (4 Stunden)

[testnet_limits.daily]
# Tages-Limits fuer Testnet-Trading
max_notional_per_day = 5000.0   # Max. Gesamt-Notional pro Tag (EUR)
max_trades_per_day = 200        # Max. Anzahl Trades pro Tag

[testnet_limits.symbols]
# Symbol-Whitelist fuer Testnet-Trading
# Nur diese Symbole sind im Testnet erlaubt
allowed = ["BTC/EUR", "ETH/EUR"]

# ============================================================================
# PHASE 37: TESTNET-SESSION-PROFILE
# ============================================================================
# Vordefinierte Profile fuer standardisierte Testnet-Sessions.
# Jedes Profil beschreibt eine spezifische Test-Konfiguration.
#
# Verwendung: python -m scripts.orchestrate_testnet_runs --profile <name>
# ============================================================================

[testnet_profiles.ma_crossover_small]
# Kleiner Intraday-Test mit MA-Crossover
strategy = "ma_crossover"
symbol = "BTC/EUR"
timeframe = "1m"
duration_minutes = 60
max_notional = 500.0
max_trades = 20
description = "Kleiner BTC/EUR Intraday-Test (1h)"

[testnet_profiles.eth_swing]
# ETH Swing-Test mit laengerer Laufzeit
strategy = "ma_crossover"
symbol = "ETH/EUR"
timeframe = "15m"
duration_minutes = 180
max_notional = 2000.0
max_trades = 40
description = "ETH Swing-Test (3h)"

[testnet_profiles.btc_momentum]
# BTC Momentum-Test mit Momentum-Strategie
strategy = "momentum_1h"
symbol = "BTC/EUR"
timeframe = "5m"
duration_minutes = 120
max_notional = 1000.0
max_trades = 30
description = "BTC Momentum-Test (2h)"

[testnet_profiles.quick_smoke]
# Schneller Smoke-Test (5 Minuten)
strategy = "ma_crossover"
symbol = "BTC/EUR"
timeframe = "1m"
duration_minutes = 5
max_notional = 100.0
max_trades = 5
description = "Schneller Smoke-Test (5min)"

# ============================================================================
# PHASE 37: TESTNET-ORCHESTRATION
# ============================================================================
# Konfiguration fuer den Testnet-Orchestrator (CLI).
# Steuert Pfade, Auto-Reports und weitere Orchestrierungs-Optionen.
# ============================================================================

[testnet_orchestration]
# Basisverzeichnis fuer Testnet-Runs
runs_base_dir = "test_runs/"

# Verzeichnis fuer generierte Reports
reports_dir = "test_results/reports/"

# Automatisch Report nach Run-Ende generieren
auto_generate_report = true

# Report-Format ("markdown", "html", "both")
report_format = "markdown"

# Altes Usage-Daten behalten (Tage)
usage_retention_days = 30

# ============================================================================
# PHASE 53: STRATEGY & PORTFOLIO LIBRARY PUSH
# ============================================================================
# Klar benannte Strategie-Konfigurationen für unterschiedliche Timeframes
# und Volatilitäts-Umgebungen mit expliziten Risk-Profilen.
# ============================================================================

# --- RSI Reversion BTC ---

[strategy.rsi_reversion_btc_conservative]
# Konservative RSI-Reversion-Strategie für BTC (1h, längere Lookbacks)
rsi_window = 21
lower = 25.0
upper = 75.0
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false
trend_ma_window = 50
use_wilder = true
price_col = "close"
stop_pct = 0.03
take_profit_pct = 0.06

[strategy.rsi_reversion_btc_moderate]
# Moderate RSI-Reversion-Strategie für BTC (1h, balanced)
rsi_window = 14
lower = 30.0
upper = 70.0
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false
trend_ma_window = 50
use_wilder = true
price_col = "close"
stop_pct = 0.04
take_profit_pct = 0.08

[strategy.rsi_reversion_btc_aggressive]
# Aggressive RSI-Reversion-Strategie für BTC (15m, höhere Trade-Frequenz)
rsi_window = 10
lower = 20.0
upper = 80.0
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false
trend_ma_window = 50
use_wilder = true
price_col = "close"
stop_pct = 0.05
take_profit_pct = 0.10

# --- RSI Reversion ETH ---

[strategy.rsi_reversion_eth_conservative]
# Konservative RSI-Reversion-Strategie für ETH (1h, längere Lookbacks)
rsi_window = 21
lower = 25.0
upper = 75.0
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false
trend_ma_window = 50
use_wilder = true
price_col = "close"
stop_pct = 0.03
take_profit_pct = 0.06

[strategy.rsi_reversion_eth_moderate]
# Moderate RSI-Reversion-Strategie für ETH (1h, balanced)
rsi_window = 14
lower = 30.0
upper = 70.0
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false
trend_ma_window = 50
use_wilder = true
price_col = "close"
stop_pct = 0.04
take_profit_pct = 0.08

[strategy.rsi_reversion_eth_aggressive]
# Aggressive RSI-Reversion-Strategie für ETH (15m, höhere Trade-Frequenz)
rsi_window = 10
lower = 20.0
upper = 80.0
exit_lower = 50.0
exit_upper = 50.0
use_trend_filter = false
trend_ma_window = 50
use_wilder = true
price_col = "close"
stop_pct = 0.05
take_profit_pct = 0.10

# --- MA Crossover BTC ---

[strategy.ma_trend_btc_conservative]
# Konservative MA-Trend-Strategie für BTC (4h, längere MAs)
fast_window = 20
slow_window = 100
price_col = "close"
stop_pct = 0.04
take_profit_pct = 0.12

[strategy.ma_trend_btc_moderate]
# Moderate MA-Trend-Strategie für BTC (1h, balanced)
fast_window = 20
slow_window = 60
price_col = "close"
stop_pct = 0.05
take_profit_pct = 0.15

[strategy.ma_trend_btc_aggressive]
# Aggressive MA-Trend-Strategie für BTC (30m, kürzere MAs)
fast_window = 10
slow_window = 40
price_col = "close"
stop_pct = 0.06
take_profit_pct = 0.20

# --- Trend Following ETH ---

[strategy.trend_following_eth_conservative]
# Konservative Trend-Following-Strategie für ETH (4h, längere Lookbacks)
adx_period = 14
adx_threshold = 25.0
exit_threshold = 20.0
ma_period = 50
use_ma_filter = true
stop_pct = 0.04
take_profit_pct = 0.12

[strategy.trend_following_eth_moderate]
# Moderate Trend-Following-Strategie für ETH (1h, balanced)
adx_period = 14
adx_threshold = 25.0
exit_threshold = 20.0
ma_period = 30
use_ma_filter = true
stop_pct = 0.05
take_profit_pct = 0.15

[strategy.trend_following_eth_aggressive]
# Aggressive Trend-Following-Strategie für ETH (30m, kürzere Lookbacks)
adx_period = 14
adx_threshold = 25.0
exit_threshold = 20.0
ma_period = 20
use_ma_filter = true
stop_pct = 0.06
take_profit_pct = 0.20

# ============================================================================
# R&D-STRATEGIEN – nur Offline/Research (NICHT für Live-Trading!)
# ============================================================================
# Diese Strategien sind ausschließlich für Research-Zwecke gedacht.
# Sie haben IS_LIVE_READY=false und dürfen nicht in Testnet/Live verwendet werden.
# ============================================================================

[strategy.armstrong_cycle]
key = "armstrong_cycle"
class_path = "strategies.armstrong.armstrong_cycle_strategy.ArmstrongCycleStrategy"
tier = "r_and_d"
is_live_ready = false
allowed_environments = ["offline_backtest", "research"]
description = "R&D: Armstrong-Zyklusmodell (nur Research/Backtests, nicht live)."
tags = ["r_and_d", "cycles", "macro", "research"]
# Default-Parameter
cycle_length_days = 3141
event_window_days = 90
reference_date = "2015-10-01"

[strategy.el_karoui_vol_model]
key = "el_karoui_vol_model"
class_path = "strategies.el_karoui.el_karoui_vol_model_strategy.ElKarouiVolModelStrategy"
tier = "r_and_d"
is_live_ready = false
allowed_environments = ["offline_backtest", "research"]
description = "R&D: El-Karoui-Volatilitäts-/Regime-Modell (nur Research/Backtests, nicht live)."
tags = ["r_and_d", "volatility", "regime", "research"]
# Default-Parameter
vol_window = 20
vol_threshold_low = 0.3
vol_threshold_high = 0.7
use_ewm = true
annualization_factor = 252.0
